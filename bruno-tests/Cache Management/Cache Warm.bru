meta {
  name: Cache Warm
  type: http
  seq: 3
}

post {
  url: {{baseUrl}}/cache/warm
  body: none
  auth: none
}

assert {
  res.status: eq 200
  res.body: isJson
}

tests {
  test("Cache warming successful", function() {
    expect(res.getStatus()).to.equal(200);
    expect(res.getBody()).to.have.property('message');
    expect(res.getBody().message).to.equal('Cache warmed successfully');
  });

  test("Response includes timestamp", function() {
    expect(res.getBody()).to.have.property('timestamp');
    expect(res.getBody().timestamp).to.be.a('string');

    // Verify it's a valid ISO timestamp
    const timestamp = new Date(res.getBody().timestamp);
    expect(timestamp.getTime()).to.not.be.NaN;
  });

  test("Timestamp is recent", function() {
    const responseTimestamp = new Date(res.getBody().timestamp);
    const now = new Date();
    const diff = now.getTime() - responseTimestamp.getTime();

    // Should be within 5 seconds
    expect(diff).to.be.below(5000);
  });

  test("Response time is reasonable for warming", function() {
    // Cache warming might take longer as it fetches from DB
    expect(res.getResponseTime()).to.be.below(5000);
  });

  test("Content-Type is JSON", function() {
    expect(res.getHeader('content-type')).to.equal('application/json');
  });
}
